<div style="width: 750px; margin: 0 auto; font-family: Arial, sans-serif; font-size: 13px; color: #333;">

  <!-- Encabezado -->
  <div style="border-bottom: 2px solid #0072BC; padding-bottom: 10px; margin-bottom: 30px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h1 style="margin: 0; color: #0072BC;">Factura</h1>
        <p style="margin: 0;">Número: <strong><%= invoice.number || invoice.id %></strong></p>
        <p style="margin: 0;">Fecha de emisión: <strong><%= invoice.date&.strftime("%d/%m/%Y") %></strong></p>
        <p style="margin: 0;">Fecha de vencimiento: <strong><%= invoice.due_date&.strftime("%d/%m/%Y") %></strong></p>
      </div>
      <div style="text-align: right;">
        <p style="font-size: 18px; color: #555;"><strong><%= invoice.from.lines.first.strip %></strong></p>
      </div>
    </div>
  </div>

  <!-- Datos de facturación -->
  <div style="margin-bottom: 30px;">
    <table style="width: 100%;">
      <tr>
        <td style="vertical-align: top;">
          <strong>De:</strong><br/>
          <%= simple_format(invoice.from) %>
        </td>
        <td style="vertical-align: top;">
          <strong>Para:</strong><br/>
          <%= simple_format(invoice.client&.name) %>
        </td>
      </tr>
    </table>
  </div>

  <!-- Tabla de conceptos -->
  <table style="width: 100%; border-collapse: collapse; border: 1px solid #ccc; margin-bottom: 20px;">
    <thead style="background-color: #e6f0fa;">
      <tr>
        <th style="border: 1px solid #ccc; padding: 8px;">Descripción</th>
        <th style="border: 1px solid #ccc; padding: 8px; text-align: right;">Cantidad</th>
        <th style="border: 1px solid #ccc; padding: 8px; text-align: right;">Precio Unitario</th>
        <th style="border: 1px solid #ccc; padding: 8px; text-align: right;">IVA</th>
        <th style="border: 1px solid #ccc; padding: 8px; text-align: right;">Total</th>
      </tr>
    </thead>
    <tbody>
      <% invoice.invoice_details.each do |detail| %>
        <tr>
          <td style="border: 1px solid #ccc; padding: 8px;"><%= detail.description %></td>
          <td style="border: 1px solid #ccc; padding: 8px; text-align: right;"><%= detail.quantity %></td>
          <td style="border: 1px solid #ccc; padding: 8px; text-align: right;"><%= number_to_currency(detail.unit_price, unit: invoice.currency || "€") %></td>
          <td style="border: 1px solid #ccc; padding: 8px; text-align: right;"><%= detail.tax_rate.present? ? "#{detail.tax_rate}%" : "0%" %></td>
          <td style="border: 1px solid #ccc; padding: 8px; text-align: right;"><%= number_to_currency(detail.quantity * detail.unit_price, unit: invoice.currency || "€") %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <!-- Totales -->
  <div style="text-align: right; margin-bottom: 40px;">
    <h3 style="margin: 0;">Total a pagar:</h3>
    <p style="font-size: 18px; margin: 5px 0;"><strong><%= number_to_currency(invoice.total, unit: invoice.currency || "€") %></strong></p>
  </div>

  <!-- Términos y condiciones -->
  <% if invoice.terms.present? %>
    <div style="margin-bottom: 40px;">
      <h4 style="margin-bottom: 5px; color: #0072BC;">Términos y condiciones</h4>
      <div style="background-color: #f9f9f9; border: 1px solid #ccc; padding: 10px;">
        <%= simple_format(invoice.terms) %>
      </div>
    </div>
  <% end %>

  <!-- Footer -->
  <div style="border-top: 1px solid #ccc; padding-top: 10px; font-size: 10px; text-align: center; color: #888;">
    Documento generado automáticamente – no requiere firma.  
    <br/>
    © <%= Date.today.year %> <%= invoice.from.lines.first.strip %>  
  </div>

</div>
