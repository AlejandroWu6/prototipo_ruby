<div class="d-flex justify-content-center align-items-center min-vh-90 p-3">
  <div class="w-100" style="max-width: 680px;">
    <div class="text-center">
      <h1 class="mb-4">Welcome to your invoice application</h1>

      <% if @invoices.present? %>
        <div class="mb-3 text-end">
          <%= link_to "New Invoice", new_invoice_path, class: "btn btn-primary" %>
        </div>

        <h2 class="mb-3">Your Invoices</h2>
        <ul class="list-group list-group-flush text-start">
          <% @invoices.order(created_at: :desc).each do |invoice| %>
            <li class="list-group-item mb-3" style="background: #fafafa; border: 1px solid #ddd; border-radius: 5px;">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <%= link_to "Invoice ##{invoice.number || invoice.id}", invoice_path(invoice), style: "text-decoration: none; color: inherit; font-weight: 600; font-size: 1.1rem;" %>
                  <br />
                  <small class="text-muted">
                    Issued on: <%= invoice.issue_date.strftime("%B %d, %Y") if invoice.issue_date %> |
                    Due: <%= invoice.due_date.strftime("%B %d, %Y") if invoice.due_date %>
                  </small>
                </div>
                <div style="font-size: 1.2rem; font-weight: 700;">
                  <%= sprintf("%.2f", invoice.total || 0) + " " + (invoice.currency || "€") %>
                </div>
              </div>

              <div class="mb-2" style="font-size: 0.9rem;">
                <strong>From:</strong> <%= invoice.from.presence || "-" %><br />
                <strong>Bill To:</strong> <%= invoice.client&.name.presence || "-" %><br />
                <strong>Payment Method:</strong> <%= invoice.payment_method.presence || "-" %><br />
                <strong>Payment Terms:</strong> <%= invoice.payment_terms.presence || "-" %><br />
                <strong>Status:</strong> <%= invoice.status.presence || "-" %>
              </div>

              <% if invoice.invoice_details.any? %>
                <details>
                  <summary style="cursor: pointer; font-weight: 600;">Details (<%= invoice.invoice_details.count %>)</summary>
                  <ul style="padding-left: 1.2rem; margin-top: 0.5rem;">
                    <% invoice.invoice_details.each do |detail| %>
                      <li>
                        <%= detail.description.presence || "No description" %> — Qty: <%= detail.quantity || 0 %>, 
                        Unit Price: <%= sprintf("%.2f", detail.unit_price || 0) + " " + (invoice.currency || "€") %>, 
                        Tax Rate: <%= detail.tax_rate ? "#{detail.tax_rate}%" : "N/A" %>
                      </li>
                    <% end %>
                  </ul>
                </details>
              <% end %>

                <% if invoice.xml.present? && invoice.format == 'facturae' %>
                <details class="mt-2">
                  <summary style="cursor: pointer; font-weight: 600;">XML Content</summary>
                  <pre style="background: #f0f0f0; padding: 1rem; margin-top: 0.5rem; font-size: 0.8rem; overflow-x: auto;">
                  <%= invoice.xml %>
                  </pre>
                </details>
                <% end %>

              <!-- Botón Exportar -->
              <% if invoice.format.present? %>
                <div class="mt-3 text-end">
                  <%= link_to "Export Invoice", export_invoice_path(invoice, format_type: invoice.format), class: "btn btn-outline-secondary btn-sm" %>
                </div>
              <% else %>
                <div class="mt-3 text-end text-muted">
                  <em>No export format</em>
                </div>
              <% end %>

            </li>
          <% end %>
        </ul>

      <% else %>
        <p class="mb-4" style="font-size: 1.8rem; font-weight: 600;">No invoices found.</p>
        <%= link_to "Create a new invoice", new_invoice_path, class: "btn btn-primary btn-lg px-4 py-3", style: "font-size: 1.5rem;" %>
      <% end %>
    </div>
  </div>
</div>
